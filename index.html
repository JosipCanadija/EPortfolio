<!doctype html>
<html lang="hr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>E-portfolio — Luka Jovanović & Josip Čanađija</title>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    /* --- Osnovni stilovi --- */
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --accent:#5eead4;
      --muted:#94a3b8;
      --accent-2:#7c3aed;
      --glass: rgba(255,255,255,0.03);
      --maxwidth:1100px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding-top: 90px;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6eef8;background:linear-gradient(180deg,#071023 0%, #07182a 60%);-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:var(--maxwidth);margin:0 auto;padding:24px;}

    /* --- Header/nav --- */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 50;
      background: rgba(7, 16, 35, 0.85);
      backdrop-filter: blur(8px);
    }
    .navrow{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:42px;height:42px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#021018;font-weight:700}
    nav{display:flex;gap:18px;align-items:center}
    nav a{color:#dff7f0;padding:8px 12px;border-radius:8px;font-weight:600;font-size:14px}
    .cta{background:var(--accent);color:#022; padding:8px 12px;border-radius:8px;font-weight:700; border:none; cursor:pointer;}

    /* --- Mobile nav --- */
    .hamburger{display:none;gap:6px;flex-direction:column;cursor:pointer}
    .hamburger span{width:22px;height:2px;background:#dff7f0;border-radius:2px}

    /* --- Desktop default --- */
    .mobilemenu {
      display: none;
    }

    .hamburger {
      display: none;
    }

    @media (max-width: 800px) {
      nav {
        display: none;
      }

      .hamburger {
        display: flex;
        z-index: 2000;
      }

      .mobilemenu {
        position: absolute;
        top: 60px;
        right: 20px;
        width: calc(100% - 40px);
        background: #0b1220;
        border: 1px solid rgba(255,255,255,0.12);
        padding: 12px;
        border-radius: 12px;
        display: none; /* prikazuje se samo klikom */
        flex-direction: column;
        z-index: 2001;
      }

      .mobilemenu a {
        padding: 10px 0;
        display: block;
        color: #dff7f0;
        font-weight: 600;
      }
    }


    /* --- Hero --- */
    .hero{display:flex;gap:24px;align-items:center;padding:48px 0}
    .hero-left{flex:1}
    .hero-right{flex:1;display:flex;align-items:center;justify-content:center}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);}

    h1{margin:6px 0 6px 0;font-size:32px}
    p.lead{color:var(--muted);margin:0 0 12px 0}

    /* --- Grid & Persons --- */
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .person{display:flex;gap:12px;align-items:flex-start}
    .avatar{width:86px;height:86px;min-width:86px;border-radius:12px;background:linear-gradient(135deg,var(--accent-2),var(--accent));display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;font-size:28px}
    .meta h3{margin:0 0 6px 0}
    .meta p{color:var(--muted);margin:0}

    /* --- Projekti --- */
    .projects{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media (max-width:900px){.projects{grid-template-columns:repeat(1,1fr)}}
    .project{padding:12px;border-radius:10px;background:var(--glass);cursor:pointer;border:1px solid rgba(255,255,255,0.03)}
    .filters{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap;}

    /* --- Vještine --- */
    #skillsCard{padding:16px}
    .controls{display:flex;gap:10px;align-items:center;margin-bottom:10px;flex-wrap:wrap;}
    .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:6px 10px;border-radius:8px;color:#dff7f0;cursor:pointer}
    .btn.active{background:rgba(255,255,255,0.03);border-color:var(--accent)}
    .tooltip{position:absolute;padding:8px 10px;background:#021019;color:#dff7f0;border-radius:6px;border:1px solid rgba(255,255,255,0.04);pointer-events:none;font-size:13px;z-index:1000}

    footer{margin-top:36px;padding:18px 0;color:var(--muted);font-size:14px;text-align:center}
    .contact-wrapper { display: flex; gap: 20px; justify-content: space-between; padding: 20px; }
    @media (max-width: 700px) { .contact-wrapper { flex-direction: column; } }
    section {
      scroll-margin-top: 100px;
    }
    </style>
</head>
<body>

  <header>
    <div class="container">
      <div class="navrow">
        <div class="brand">
          <div class="logo">TIW</div>
          <div>
            <div style="font-weight:700">E-portfolio</div>
            <div class="muted" style="font-size:13px">Luka Jovanović & Josip Čanađija</div>
          </div>
        </div>
        <nav>
          <a href="#home">Početna</a>
          <a href="#about">O nama</a>
          <a href="#projects">Projekti</a>
          <a href="#skills">Vještine</a>
          <a href="#analytics">Analitika</a>
          <a href="#funnel">Funnel analiza</a>
          <a href="#retention">Retention</a>
          <a href="#contact" class="cta">Kontakt</a>
        </nav>
        <div class="hamburger" id="hambtn">
          <span></span><span></span><span></span>
        </div>
        <div class="mobilemenu card" id="mobilemenu">
          <a href="#home">Početna</a>
          <a href="#about">O nama</a>
          <a href="#projects">Projekti</a>
          <a href="#skills">Vještine</a>
          <a href="#analytics">Analitika</a>
          <a href="#funnel">Funnel analiza</a>
          <a href="#retention">Retention</a>
          <a href="#contact">Kontakt</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <section id="home" class="hero">
      <div class="hero-left">
        <div class="card">
          <h1>Dobrodošli na e-portfolio Luke Jovanovića & Josipa Čanađije</h1>
          <p class="lead">Zajednički projektni zadatak za predmet <strong>Tehnologije Interaktivnog Weba</strong>.</p>
          <div style="display:flex;gap:8px;margin-top:12px">
            <a class="btn" href="#projects">Projekti</a>
            <a class="btn" href="#skills">Vještine</a>
          </div>
        </div>
      </div>
      
      <div class="hero-right">
        <div class="card" style="width:320px;text-align:center">
          <h3>Google Analytics Live</h3>
          <p class="muted" id="authStatus">Status: Nije autorizirano</p>
          <div style="display:flex; flex-direction:column; gap:8px; margin-top:12px; justify-content:center">
            <button class="cta" onclick="handleAuthClick()">Autoriziraj pristup</button>
            <button class="btn" id="revokeBtn" onclick="revokeToken()" style="display:none">Odjavi se</button>
          </div>
          <div id="apiResult" style="margin-top:15px; font-weight:bold; color:var(--accent); min-height: 20px;"></div>
        </div>
      </div>
    </section>

    <section id="about" style="margin-top:10px">
      <h2>O nama</h2>
      <div class="grid">
        <div class="card person">
          <div class="avatar">LJ</div>
          <div class="meta">
            <h3>Luka Jovanović</h3>
            <p class="muted">Game dizajn / 3D dizajn</p>
            <p class="muted" style="font-size:13px; margin-top:5px;">Student iz Istre, zaljubljen u 3D modeliranje (SolidWorks, Blender) i game dizajn.</p>
          </div>
        </div>
        <div class="card person">
          <div class="avatar">JČ</div>
          <div class="meta">
            <h3>Josip Čanađija</h3>
            <p class="muted">Backend / Chatbot integracija</p>
            <p class="muted" style="font-size:13px; margin-top:5px;">Student iz Kastva. Iskusan u web aplikacijama i 2D pixel umjetnosti.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="projects" style="margin-top:18px">
      <h2>Projekti</h2>
      <div class="card">
        <div class="filters">
          <button class="btn active" data-filter="all">Svi</button>
          <button class="btn" data-filter="web">Web</button>
          <button class="btn" data-filter="game">Igra</button>
          <button class="btn" data-filter="mobile">Mobile</button>
          <button class="btn" data-filter="luka">Luka</button>
          <button class="btn" data-filter="josip">Josip</button>
        </div>
        <div id="projectsList" class="projects"></div>
      </div>
    </section>

    <section id="recommendations" style="margin-top:18px">
      <h2>Preporučeno za vas</h2>
      <div id="recommendationBox" class="card">
        Kliknite na projekt kako bi se prikazale preporuke.
      </div>
    </section>

    <section id="skills" style="margin-top:18px">
      <h2>Vještine (D3.js Vizualizacija)</h2>
      <div id="skillsCard" class="card">
        <div class="controls">
          <button class="btn active" id="sortBtn">Sortiraj</button>
          <button class="btn" id="toggleBtn">Grupirano/Složeno</button>
        </div>
        <div id="chartWrap" style="position:relative">
          <svg id="skillsSvg" width="100%" height="360"></svg>
          <div id="legend" style="margin-top:8px;display:flex;gap:12px;flex-wrap:wrap"></div>
        </div>
      </div>
    </section>

    <section id="analytics" style="margin-top:18px">
      <h2>Analitika korisničkog ponašanja</h2>
      <p class="muted">
      Vizualni prikaz osnovnih metrika i analiza ponašanja korisnika temeljen na Google Analytics API-ju i simuliranim podacima
      </p>
      <div class="card" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px">
        <div>
          <h4>Korisnici po uređaju</h4>
          <svg id="deviceUsersChart" width="100%" height="260"></svg>
        </div>
        <div>
          <h4>Sesije po uređaju</h4>
          <svg id="deviceSessionsChart" width="100%" height="260"></svg>
        </div>
        <div>
          <h4>Eventi po uređaju</h4>
          <svg id="deviceEventsChart" width="100%" height="260"></svg>
        </div>
    </div>

    <p class="muted" style="font-size:13px">
    Vizualizacija koristi simulirane Google Analytics podatke zbog ograničenja pristupa stvarnom GA property-ju
    </p>


    </section>

    <section id="funnel" style="margin-top:18px">
      <h2>Funnel analiza korisničkog toka</h2>
      <svg id="funnelChart" width="100%" height="300"></svg>
      <p class="muted" id="funnelText"></p>
    </section>

    <section id="retention" style="margin-top:18px">
      <h2>Retention analiza</h2>
      <svg id="retentionChart" width="100%" height="260"></svg>
      <p class="muted" id="retentionText"></p>
    </section>


    <section id="contact" style="margin-top:18px">
      <h2>Kontakt</h2>
      <div class="card contact-wrapper">
        <div class="contact-person">
          <h3>Luka Jovanović</h3>
          <p>Email: <a href="mailto:luka.jovanovic1@uniri.hr">luka.jovanovic1@uniri.hr</a></p>
          <a class="btn" href="https://github.com/" target="_blank">GitHub</a>
        </div>
        <div class="contact-person">
          <h3>Josip Čanađija</h3>
          <p>Email: <a href="mailto:josip.canadija@uniri.hr">josip.canadija@uniri.hr</a></p>
          <a class="btn" href="https://github.com/" target="_blank">GitHub</a>
        </div>
      </div>
    </section>

    <footer>
      <div class="muted">© <span id="year"></span> Luka Jovanović & Josip Čanađija</div>
    </footer>
  </main>

  <div id="tooltip" class="tooltip" style="display:none"></div>

  <script>
    /* --- KONFIGURACIJA PODATAKA --- */
    const CLIENT_ID = '957685458276-it15kjr8lp67po47lg5ef7gjgt99jc50.apps.googleusercontent.com';
    const PROPERTY_ID = '487589639';
    const SCOPES = 'https://www.googleapis.com/auth/analytics.readonly';

    window.gaData = [];
    let analyticsSource = "mock";

    const team = [
      { id: "Luka", name: "Luka Jovanović", color: "#5eead4", skills: {"HTML/CSS": 75, "JavaScript": 36, "D3.js": 28, "Unity": 91, "Blender": 80} },
      { id: "Josip", name: "Josip Čanađija", color: "#7c3aed", skills: {"HTML/CSS": 70, "JavaScript": 50, "D3.js": 35, "Unity": 90, "Blender": 20} }
    ];

    /*const projectsData = [
      {id:1,title:"Light Rush",tags:["game","luka"],short:"3D infinite runner."},
      {id:2,title:"MuscleBuddy",tags:["mobile","luka","josip"],short:"Fitness app."},
      {id:6,title:"Dungeon Core",tags:["game","josip"],short:"Tower defense."},
      {id:9,title:"Kastav Turizam",tags:["web","josip"],short:"Web stranica agencije."}
    ];*/

    const projectsData = [
      { id: 1, title: "Light Rush", tags: ["game", "luka"], short: "3D infinite runner izrađen u Unityju." },
      { id: 2, title: "Crystal Caverns", tags: ["game", "luka"], short: "Puzzle-platformer s fokusom na fiziku." },
      { id: 3, title: "Dungeon Core", tags: ["game", "josip"], short: "Tower defense igra s proceduralnim mapama." },
      { id: 4, title: "Pixel Arena", tags: ["game", "josip"], short: "2D pixel-art arena fighting igra." },
      { id: 5, title: "Kastav Turizam", tags: ["web", "josip"], short: "Web stranica za lokalnu turističku zajednicu." },
      { id: 6, title: "Student Planner", tags: ["web", "josip"], short: "Web aplikacija za planiranje studentskih obveza." },
      { id: 7, title: "MuscleBuddy", tags: ["mobile", "luka", "josip"], short: "Mobilna aplikacija za praćenje treninga." },
      { id: 8, title: "HealthyTrack", tags: ["mobile", "josip"], short: "Mobilna aplikacija za praćenje zdravih navika." },
      { id: 9, title: "3D Portfolio", tags: ["web", "luka"], short: "Web portfolio s integriranim 3D modelima." }
    ];


    // --- SIMULIRANI GA PODACI ---
    const mockGAData = [
      { device: "desktop", users: 120, sessions: 180, events: 450 },
      { device: "mobile", users: 90, sessions: 140, events: 300 },
      { device: "tablet", users: 20, sessions: 30, events: 60 }
    ];



    /* --- OAUTH 2.0 LOGIKA --- */
    let tokenClient;
    let accessToken = null;

    function initTokenClient() {
      tokenClient = google.accounts.oauth2.initTokenClient({
        client_id: CLIENT_ID,
        scope: SCOPES,
        callback: (tokenResponse) => {
          if (tokenResponse && tokenResponse.access_token) {
            accessToken = tokenResponse.access_token;
            document.getElementById('authStatus').innerText = "Status: Autoriziran ✅";
            document.getElementById('revokeBtn').style.display = 'inline-block';
            let analyticsSource = "ga";
            runAnalyticsReport();
          }
        },
      });
    }

    function handleAuthClick() {
      tokenClient.requestAccessToken({ prompt: 'consent' });
    }

    async function runAnalyticsReport() {
      const url = `https://analyticsdata.googleapis.com/v1beta/properties/${PROPERTY_ID}:runReport`;

      const body = {
        dateRanges: [{ startDate: '7daysAgo', endDate: 'today' }],
        dimensions: [
          { name: 'deviceCategory' },
          { name: 'pagePath' }
        ],
        metrics: [
          { name: 'activeUsers' },
          { name: 'sessions' },
          { name: 'eventCount' }
        ]
      };

      try {
        const res = await fetch(url, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(body)
        });

        const data = await res.json();
        console.log("FULL GA RESPONSE:", JSON.stringify(data, null, 2));


        if (data.rows && data.rows.length > 0) {
          analyticsSource = "ga";

          window.gaData = data.rows.map(r => ({
            device: r.dimensionValues[0].value,
            users: Number(r.metricValues[0].value),
            sessions: Number(r.metricValues[1].value),
            events: Number(r.metricValues[2].value)
          }));

          document.getElementById("apiResult").innerText =
            "GA podaci dohvaćeni (stvarni podaci) ✔️";

          redrawAnalyticsCharts();
        } else {
          analyticsSource = "mock";
          window.gaData = mockGAData;

          document.getElementById("apiResult").innerText =
            "GA nema dopuštenje – koriste se simulirani podaci ⚠️";

          redrawAnalyticsCharts();
        }


        document.getElementById('apiResult').innerText = "Podaci uspješno dohvaćeni ✔️";

      } catch (e) {
          console.error("GA error:", e);

          analyticsSource = "mock";
          window.gaData = mockGAData;

          document.getElementById("apiResult").innerText =
            "Greška pri GA dohvaćanju – mock podaci aktivni ⚠️";

          redrawAnalyticsCharts();
        }

    }


    function revokeToken() {
      if (accessToken) {
        google.accounts.oauth2.revoke(accessToken, () => {
          accessToken = null;
          document.getElementById('authStatus').innerText = "Status: Odjavljen";
          document.getElementById('revokeBtn').style.display = 'none';
          document.getElementById('apiResult').innerText = "";
        });
      }
    }

    const funnelData = [
      { step: "Landing page", users: 300 },
      { step: "Pregled projekata", users: 210 },
      { step: "Klik na projekt", users: 140 },
      { step: "Klik na preporuku", users: 60 }
    ];

    const retentionData = [
      { day: "Day 0", users: 100 },
      { day: "Day 1", users: 45 },
      { day: "Day 7", users: 18 }
    ];


    function drawFunnelChart() {
      const svg = d3.select("#funnelChart");
      svg.selectAll("*").remove();

      const width = svg.node().getBoundingClientRect().width || 600;
      const height = 300;
      const margin = { top: 20, right: 20, bottom: 40, left: 120 };

      const x = d3.scaleLinear()
        .domain([0, d3.max(funnelData, d => d.users)])
        .range([0, width - margin.left - margin.right]);

      const y = d3.scaleBand()
        .domain(funnelData.map(d => d.step))
        .range([0, height - margin.top - margin.bottom])
        .padding(0.3);

      const g = svg.append("g")
        .attr("transform", `translate(${margin.left},${margin.top})`);

      g.append("g").call(d3.axisLeft(y));
      g.append("g")
        .attr("transform", `translate(0,${height - margin.top - margin.bottom})`)
        .call(d3.axisBottom(x));

      g.selectAll("rect")
        .data(funnelData)
        .enter()
        .append("rect")
        .attr("y", d => y(d.step))
        .attr("height", y.bandwidth())
        .attr("width", d => x(d.users))
        .attr("fill", "#5eead4");

      document.getElementById("funnelText").innerText ="Najveći pad korisnika događa se između pregleda projekata i klika na konkretan projekt, što upućuje na potrebu jasnijih CTA elemenata i vizualne hijerarhije";
    }

    function drawRetentionChart() {
      const svg = d3.select("#retentionChart");
      svg.selectAll("*").remove();

      const width = svg.node().getBoundingClientRect().width || 600;
      const height = 260;
      const margin = { top: 20, right: 20, bottom: 40, left: 60 };

      const x = d3.scaleBand()
        .domain(retentionData.map(d => d.day))
        .range([margin.left, width - margin.right])
        .padding(0.3);

      const y = d3.scaleLinear()
        .domain([0, 100])
        .range([height - margin.bottom, margin.top]);

      svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x));

      svg.append("g")
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(y));

      svg.selectAll("rect")
        .data(retentionData)
        .enter()
        .append("rect")
        .attr("x", d => x(d.day))
        .attr("y", d => y(d.users))
        .attr("height", d => y(0) - y(d.users))
        .attr("width", x.bandwidth())
        .attr("fill", "#7c3aed");

      document.getElementById("retentionText").innerText ="Day 1 retention iznosi 45%, dok Day 7 pada na 18%, što sugerira solidan prvi dojam, ali slabiju dugoročnu vrijednost aplikacije bez dodatnog angažmana";
    }


    /* --- UI & D3 GRAF --- */
    window.onload = () => {
      initTokenClient();
      document.getElementById('year').textContent = new Date().getFullYear();
      renderProjects();
      draw();
      redrawAnalyticsCharts();
      drawFunnelChart();
      drawRetentionChart();
    };

    // Mobile menu toggle
    const hambtn = document.getElementById('hambtn');
    const mobilemenu = document.getElementById('mobilemenu');
    hambtn.onclick = () => {
      const isVisible = mobilemenu.style.display === 'flex';
      mobilemenu.style.display = isVisible ? 'none' : 'flex';
    };

    function renderProjects(filter = 'all') {
      const list = document.getElementById('projectsList');
      list.innerHTML = '';

      projectsData
        .filter(p => filter === 'all' || p.tags.includes(filter))
        .forEach(p => {
          const el = document.createElement('div');
          el.className = 'project card';
          el.dataset.category = p.tags.find(t =>
            ["web", "game", "mobile"].includes(t)
          );

          el.innerHTML = `<h4>${p.title}</h4><p class="muted">${p.short}</p>`;
          list.appendChild(el);
        });

      initRecommendations();
    }


    function initRecommendations() {
      const projects = document.querySelectorAll(".project");
      const box = document.getElementById("recommendationBox");

      if (!projects.length || !box) return;

      projects.forEach(project => {
        project.onclick = () => {
          const category = project.dataset.category;

          const related = [...projects].filter(p =>
            p.dataset.category === category && p !== project
          );

          if (related.length > 0) {
            box.innerHTML =
              `<strong>Preporučujemo:</strong> ${related[0].querySelector("h4").innerText}`;
          } else {
            box.innerHTML =
              `<strong>Preporučujemo:</strong> Najpopularniji projekt`;
          }
        };
      });
    }



    document.querySelectorAll('[data-filter]').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('[data-filter]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        renderProjects(btn.getAttribute('data-filter'));
      };
    });

    // D3 Crtanje (pojednostavljeno za ovaj prikaz)
    const skillSet = ["HTML/CSS", "JavaScript", "D3.js", "Unity", "Blender"];
    let grouped = true;

    function draw() {
      const wrap = document.getElementById('chartWrap');
      const svg = d3.select('#skillsSvg');
      svg.selectAll('*').remove();
      
      const width = wrap.clientWidth;
      const height = 360;
      const margin = {top: 20, right: 30, bottom: 40, left: 100};
      
      const x = d3.scaleLinear().domain([0, 100]).range([0, width - margin.left - margin.right]);
      const y = d3.scaleBand().domain(skillSet).range([0, height - margin.top - margin.bottom]).padding(0.2);

      const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

      g.append('g').call(d3.axisLeft(y));
      g.append('g').attr('transform', `translate(0,${height-margin.top-margin.bottom})`).call(d3.axisBottom(x));

      skillSet.forEach(skill => {
        team.forEach((m, i) => {
          g.append('rect')
            .attr('x', 0)
            .attr('y', y(skill) + (grouped ? (i * y.bandwidth()/2) : 0))
            .attr('width', x(m.skills[skill] || 0))
            .attr('height', grouped ? y.bandwidth()/2 : y.bandwidth())
            .attr('fill', m.color)
            .attr('opacity', grouped ? 1 : 0.6);
        });
      });
    }

    document.getElementById("toggleBtn").onclick = () => {
      grouped = !grouped;
      document.getElementById("toggleBtn").classList.toggle("active");
      draw();
    };

    document.getElementById("sortBtn").onclick = () => {
      skillSet.sort((a, b) => {
        const sumA = team.reduce((s, m) => s + (m.skills[a] || 0), 0);
        const sumB = team.reduce((s, m) => s + (m.skills[b] || 0), 0);
        return sumB - sumA;
      });
      draw();
    };


    function drawBarChart(svgId, valueKey, color, data = mockGAData) {
      const svg = d3.select(svgId);
      svg.selectAll("*").remove();

      const width = svg.node().getBoundingClientRect().width;
      const height = 260;
      const margin = { top: 20, right: 20, bottom: 40, left: 50 };

      const x = d3.scaleBand()
        .domain(data.map(d => d.device))
        .range([margin.left, width - margin.right])
        .padding(0.3);

      const y = d3.scaleLinear()
        .domain([0, d3.max(data, d => d[valueKey])])
        .nice()
        .range([height - margin.bottom, margin.top]);

      svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x));

      svg.append("g")
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(y));

      svg.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
        .attr("x", d => x(d.device))
        .attr("y", d => y(d[valueKey]))
        .attr("height", d => y(0) - y(d[valueKey]))
        .attr("width", x.bandwidth())
        .attr("fill", color);
    }

    function redrawAnalyticsCharts() {
      const sourceData = analyticsSource === "ga" ? window.gaData : mockGAData;

      drawBarChart("#deviceUsersChart", "users", "#5eead4", sourceData);
      drawBarChart("#deviceSessionsChart", "sessions", "#7c3aed", sourceData);
      drawBarChart("#deviceEventsChart", "events", "#22c55e", sourceData);
    }


  </script>

  <script>
    window.__ow = window.__ow || {};
    window.__ow.organizationId = "b9cb08aa-5337-40d4-8dad-bbff77c3c2c8";
    window.__ow.template_id = "0ee65c99-d5dd-451b-8b1c-003d08f8540c";
    window.__ow.integration_name = "manual_settings";
    window.__ow.product_name = "chatbot";   
    ;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:"2.0",on:function(){i(["on",c.call(arguments)])},init:function(){var n=t.createElement("script");n.async=!0,n.type="text/javascript",n.src="https://cdn.openwidget.com/openwidget.js",t.head.appendChild(n)}};!n.__ow.asyncInit&&e.init(),n.OpenWidget=n.OpenWidget||e}(window,document,[].slice))
  </script>
</body>
</html>
